var Lang=function(){var t=function(t,a,e){var n=this,r;this._fireEvents=!0,this._dynamic={},this._mutationCopies={append:$.fn.append,appendTo:$.fn.appendTo,prepend:$.fn.prepend,before:$.fn.before,after:$.fn.after,html:$.fn.html},$.fn.append=function(){return n._mutation(this,"append",arguments)},$.fn.appendTo=function(){return n._mutation(this,"appendTo",arguments)},$.fn.prepend=function(){return n._mutation(this,"prepend",arguments)},$.fn.before=function(){return n._mutation(this,"before",arguments)},$.fn.after=function(){return n._mutation(this,"after",arguments)},$.fn.html=function(){return n._mutation(this,"html",arguments)},this.defaultLang=t||"en",this.currentLang=t||"en",!e&&a||!$.cookie||(r=$.cookie("langCookie"),r&&(a=r)),$(function(){n._start(),a&&a!==n.defaultLang&&n.change(a)})};return t.prototype.pack={},t.prototype.attrList=["title","alt","placeholder","href"],t.prototype.dynamic=function(t,a){void 0!==t&&void 0!==a&&(this._dynamic[t]=a)},t.prototype.loadPack=function(t,a){var e=this;if(!t||!e._dynamic[t])throw"Cannot load language pack, no file path specified!";$.ajax({dataType:"json",url:e._dynamic[t],success:function(n){if(e.pack[t]=n,e.pack[t].regex){var r=e.pack[t].regex,i,o;for(o=0;o<r.length;o++)i=r[o],2===i.length?i[0]=new RegExp(i[0]):3===i.length&&(i[0]=new RegExp(i[0],i[1]),i.splice(1,1))}a&&a(!1,t,e._dynamic[t])},error:function(){throw a&&a(!0,t,e._dynamic[t]),"Error loading language pack"+e._dynamic[t]}})},t.prototype._start=function(t){for(var a=void 0!==t?$(t).find("[lang]"):$(":not(html)[lang]"),e=a.length,n;e--;)n=$(a[e]),this._processElement(n)},t.prototype._processElement=function(t){t.attr("lang")===this.defaultLang&&(this._storeAttribs(t),this._storeContent(t))},t.prototype._storeAttribs=function(t){var a,e,n;for(a=0;a<this.attrList.length;a++)e=this.attrList[a],t.attr(e)&&(n=t.data("lang-attr")||{},n[e]=t.attr(e),t.data("lang-attr",n))},t.prototype._storeContent=function(t){if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":t.data("lang-val",t.val())}else if(t.is("img"))t.data("lang-src",t.attr("src"));else{var a=this._getTextNodes(t);a&&t.data("lang-text",a)}},t.prototype._getTextNodes=function(t){var a=t.contents(),e=[],n={},r,i=this,o=Array.prototype.map;return $.each(a,function(t,a){3===a.nodeType&&(n={node:a,langDefaultText:a.data},e.push(n))}),e},t.prototype._setTextNodes=function(t,a,e){var n,r,i,o,s=e!==this.defaultLang;for(n=0;n<a.length;n++)if(r=a[n],s){if(i=$.trim(r.langDefaultText))if(o=this.translate(i,e))try{r.node.data=r.node.data.split($.trim(r.node.data)).join(o)}catch(c){}else console&&console.log&&console.log('Translation for "'+i+'" not found!')}else try{r.node.data=r.langDefaultText}catch(c){}},t.prototype._translateAttribs=function(t,a){var e,n=t.data("lang-attr")||{},r;for(e in n)n.hasOwnProperty(e)&&t.attr(e)&&(a!==this.defaultLang?(r=this.translate(n[e],a),r&&t.attr(e,r)):t.attr(e,n[e]))},t.prototype._translateContent=function(t,a){var e=a!==this.defaultLang,n,r;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":e?(n=this.translate(t.data("lang-val"),a),n&&t.val(n)):t.val(t.data("lang-val"))}else t.is("img")?e?(n=this.translate(t.data("lang-src"),a),n&&t.attr("src",n)):t.attr("src",t.data("lang-src")):(r=t.data("lang-text"),r&&this._setTextNodes(t,r,a))},t.prototype.change=function(t,a,e){var n=this;if(t!==this.defaultLang&&!this.pack[t]&&!this._dynamic[t])throw e&&e("No language pack defined for: "+t,t,a),'Attempt to change language to "'+t+'" but no language pack for that language is loaded!';if(t!==this.defaultLang){if(!this.pack[t]&&this._dynamic[t])return void this.loadPack(t,function(r,i,o){r?e&&e("Language pack could not load from: "+o,t,a):n.change.call(n,t,a,e)});if(!this.pack[t]&&!this._dynamic[t])throw e&&e("Language pack not defined for: "+t,t,a),"Could not change language to "+t+" because no language pack for this language exists!"}var r=!1,i=this.currentLang;this.currentLang!=t&&(this.beforeUpdate(i,t),r=!0),this.currentLang=t;for(var o=void 0!==a?$(a).find("[lang]"):$(":not(html)[lang]"),s=o.length,c;s--;)c=$(o[s]),c.attr("lang")!==t&&this._translateElement(c,t);r&&this.afterUpdate(i,t),$.cookie&&$.cookie("langCookie",t,{expires:365,path:"/"}),e&&e(!1,t,a)},t.prototype._translateElement=function(t,a){this._translateAttribs(t,a),"false"!=t.attr("data-lang-content")&&this._translateContent(t,a),t.attr("lang",a)},t.prototype.translate=function(t,a){if(a=a||this.currentLang,this.pack[a]){var e="";return a!=this.defaultLang?(e=this.pack[a].token[t],e||(e=this._regexMatch(t,a)),e||console&&console.log&&console.log('Translation for "'+t+'" not found in language pack: '+a),e||t):t}return t},t.prototype._regexMatch=function(t,a){var e,n,r,i,o,s;if(e=this.pack[a].regex)for(n=e.length,r=0;n>r;r++)if(i=e[r],o=i[0],s=o.exec(t),s&&s[0])return t.split(s[0]).join(i[1]);return""},t.prototype.beforeUpdate=function(t,a){this._fireEvents&&$(this).triggerHandler("beforeUpdate",[t,a,this.pack[t],this.pack[a]])},t.prototype.afterUpdate=function(t,a){this._fireEvents&&$(this).triggerHandler("afterUpdate",[t,a,this.pack[t],this.pack[a]])},t.prototype.refresh=function(){this._fireEvents=!1,this.change(this.currentLang),this._fireEvents=!0},t.prototype._mutation=function(t,a,e){var n=this._mutationCopies[a].apply(t,e),r=this.currentLang,i=$(t);return i.attr("lang")&&(this._fireEvents=!1,this._translateElement(i,this.defaultLang),this.change(this.defaultLang,i),this.currentLang=r,this._processElement(i),this._translateElement(i,this.currentLang)),this._start(i),this.change(this.currentLang,i),this._fireEvents=!0,n},t}();